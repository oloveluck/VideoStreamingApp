<!DOCTYPE html>
<html>
    <body>
        <h1>Welcome to <a href="https://github.com/oloveluck/VideoStreamingApp">Yet Another TV App</a></h1>
        
        <pre id="output"> Results are shown here!</pre>
        <div id="register">
            <h4>Register a user</h4>
            <label>First Name: <input type="text" name="firstName"></label>
            <label>Last Name: <input type="text" name="lastName"></label>
            <label>Email: <input type="text" name="email"></label>
            <label>Password: <input type="text" name="password"></label>
            <label>Country: <input type="text" name="country"></label>
            <button onclick="register()">Submit</button>
        </div>
        <div id="subscribe">
            <h4>Subscribe to an app</h4>
            <label>Email: <input type="text" name="email"></label>
            <label>App: <input type="text" name="app"></label>
            <button onclick="subscribe()">Submit</button>
        </div>
        <div id="listadd">
            <h4>Add a show to a users list</h4>
            <label>Email: <input type="text" name="email"></label>
            <label>Show: <input type="text" name="show"></label>
            <button onclick="listadd()">Submit</button>
        </div>
        <div id="version">
            <h4>Update an app's version on a certain platform</h4>
            <label>Version: <input type="text" name="version"></label>
            <label>App: <input type="text" name="app"></label>
            <label>Platform: <input type="text" name="platform"></label>
            <button onclick="version()">Submit</button>
        </div>
        <div id="videoadd">
            <h4>add a new video</h4>
            <label>Release Date: <input type="text" name="releaseDate"></label>
            <label>Tile: <input type="text" name="title"></label>
            <label>Description: <input type="text" name="description"></label>
            <label>Duration: <input type="text" name="duration"></label>
            <label>Platform: <input type="text" name="platform"></label>
            <button onclick="videoadd()">Submit</button>
        </div>
        <div id="topTen">
            <h4>produce a ranked list of the top 10 watched shows corresponding with each app</h4>
            <button onclick="topTen()">Get</button>
        </div>
        <div id="free">
            <h4>find all free videos on a particular platform</h4>
            <label>Platform: <input type="text" name="platform"></label>
            <button onclick="free()">Get</button>
        </div>
        <div id="longvideos">
            <h4>find all long videos that were released this year and aren't part of any show</h4>
            <label>Duration: <input type="text" name="duration"></label>
            <button onclick="longvideos()">Get</button>
        </div>
        <div id="revenue">
            <h4>produce a ranked list of revenue generated by apps in a country</h4>
            <button onclick="revenue()">Get</button>
        </div>
        <div id="views">
            <h4>produce a ranked list of watched counts from the top 3 video tags</h4>
            <button onclick="views()">Get</button>
        </div>
        <div id="worstapp">
            <h4>Find the the app available on iOS that has the most videos that user with first name ? and last name ? has watched but does not like</h4>
            <label>First Name: <input type="text" name="firstname"></label>
            <label>Last Name: <input type="text" name="lastname"></label>
            <button onclick="worstapp()">Get</button>
        </div>
        <div id="likedmobile">
            <h4>produce a list of users and whether or not they liked a video on a mobile platform. If they did, the title of the video is included</h4>
            <button onclick="likedmobile()">Get</button>
        </div>
        <div id="freevideos">
            <h4>produce a list of all videos that people want to watch and are free</h4>
            <button onclick="freevideos()">Get</button>
        </div>
        <div id="season">
            <h4>given a video name, produce all videos in its season, or just details on the video if it does not belong to a season</h4>
            <label>Video: <input type="text" name="video"></label>
            <button onclick="season()">Get</button>
        </div>
        <div id="appshows">
            <h4>list every show that a specific paramaterized app has videos for</h4>
            <label>App: <input type="text" name="app"></label>
            <button onclick="appshows()">Get</button>
        </div>
        <script>
            const BASE_URL = "http://localhost:8080"

            const register = () => {
                let urlencoded = getUrlEncoded("register");
                getData(`${BASE_URL}/register`, "POST", urlencoded);
            }

            const subscribe = () => {
                let urlencoded = getUrlEncoded("subscribe");
                getData(`${BASE_URL}/subscribe`, "POST", urlencoded);
            }

            const listadd = () => {
                let urlencoded = getUrlEncoded("listadd");
                getData(`${BASE_URL}/list/add`, "POST", urlencoded);
            }

            const version = () => {
                let urlencoded = getUrlEncoded("version");
                getData(`${BASE_URL}/version`, "POST", urlencoded);
            }

            const videoadd = () => {
                let urlencoded = getUrlEncoded("videoadd");
                getData(`${BASE_URL}/video/add`, "POST", urlencoded);
            }

            const topTen = () => {
                getData(`${BASE_URL}/top-10`, "GET");
            }

            const free = () => {
                let urlencoded = getUrlEncoded("free");
                getData(`${BASE_URL}/free`, "GET", urlencoded);
            }

            const longvideos = () => {
                let urlencoded = getUrlEncoded("longvideos");
                getData(`${BASE_URL}/video/released`, "GET", urlencoded);
            }

            const revenue = () => {
                getData(`${BASE_URL}/revenue`, "GET");
            }

            const views = () => {
                getData(`${BASE_URL}/views`, "GET");
            }

            const worstapp = () => {
                let urlencoded = getUrlEncoded("worstapp");
                getData(`${BASE_URL}/worst-app`, "GET", urlencoded);
            }

            const likedmobile = () => {
                getData(`${BASE_URL}/liked-mobile`, "GET");
            }

            const freevideos = () => {
                getData(`${BASE_URL}/free-videos`, "GET");
            }

            const season = () => {
                let urlencoded = getUrlEncoded("season");
                getData(`${BASE_URL}/season`, "GET", urlencoded);
            }

            const appshows = () => {
                let urlencoded = getUrlEncoded("appshows");
                getData(`${BASE_URL}/appshows`, "GET", urlencoded);
            }


            

            const getData = async (url, type, urlencoded) => {
                let result;
                let text = '';
                if(type === "GET") {
                    if(urlencoded) {
                        url = `${url}?${urlencoded}`
                    } 
                    console.log('URL', url);
                    result = await fetch(url);
                   
                } else {
                    let myHeaders = new Headers();
                    myHeaders.append("Content-Type", "application/x-www-form-urlencoded");
                    let requestOptions = {
                    method: type,
                    headers: myHeaders,
                    body: urlencoded,
                    mode:'cors'
                    }
                    result = await fetch(url, requestOptions);
                }
                
                if(result.ok) {
                    let resultjson = await result.json();
                    if(resultjson.hasOwnProperty("rows")) {
                        let count = 1;
                        resultjson["rows"].forEach(row => {
                            text += `${count}. `
                            Object.keys(row).forEach(att => {
                                text += `${att} : ${row[att]}, `
                            })
                            text = text.substring(0, text.length - 2)
                            text += '\n';
                            count++;
                        })
                    } else {
                        text = resultjson["msg"];
                    }
                }
                
                document.getElementById("output").innerHTML = text;
            }

            const getUrlEncoded = (inputName) => {
                let urlencoded = new URLSearchParams();
                Array.from(document.querySelectorAll(`#${inputName} input`)).forEach(input => {
                    urlencoded.append(input.name, input.value);
                })
                return urlencoded
            }
        </script>
    </body>
</html>